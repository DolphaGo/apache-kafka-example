# 토픽이란

- 카프카에선 토픽을 여러개 생성할 수 있다.

- 토픽은 데이터베이스의 테이블이나 파일시스템의 폴더와 유사한 구조
- 프로듀서는 이 토픽에 데이터를 보내고 컨슘은 이 토픽에서 데이터를 가져올 수 있다.
- 토픽에는 이름을 지정할 수 있어서 추후 유지보수에 용이하다.


- 하나의 토픽은 여러개의 파티션으로 구성될 수 있으며, 첫 번째 파티션 번호는 0번부터 시작한다.
- 
![](/images/2022-06-02-15-39-36.png)

- 컨슈머가 레코드들을 가져가도 데이터는 삭제되지 않습니다.
- 파티션에 남은 데이터는 누가 들고 가는 것일까요?
  - 새로운 컨슈머가 붙었을 때 다시 0번부터 가져갈 수 있습니다.
    - 대신, **컨슈머 그룹이 달라야하고, auto.offset.reset=earliest** 여야 합니다.
  - 이처럼 사용할 경우 동일한 데이터를 여러번 처리할 수 있는데, 이는 카프카를 사용하는 데 있어서 아주 중요한 일이다.


- 파티션이 2개이상인 경우

![](/images/2022-06-02-15-41-32.png)

- 어느 파티션으로 데이터를 보내야 할까?

1. 키가 null, 기본 파티셔너를 사용할 경우 -> 라운드 로빈으로 할당
2. 키가 있고, 기본 파티셔너를 사용할 경우 -> 키의 해시값을 구하고, 특정 파티션에 할당한다.

위의 경우엔 키를 따로 지정하지 않았으므로, 라운드로빈으로 값이 들어가게 된다.

![](/images/2022-06-02-15-42-42.png)

이번엔 위와 같이 파티션을 하나 더 늘렸는데 조심해야할 점이 있다.
- **파티션은 늘릴 수는 있지만 줄일 수는 없다는 점**이다.

왜 파티션을 늘리는 것일까?
- 파티션을 늘리면 컨슈머 개수를 늘려서 데이터 처리 속도를 높일 수 있다.

파티션의 레코드는 언제 삭제되는가?
- 삭제되는 타이밍은 옵션에 따라 다르다.
- 레코드가 저장되는 최대시간과 크기를 지정할 수 있다.
  - 일정한 기간, 용량만큼 데이터를 저장할 수 있고, 적절하게 데이터를 삭제할 수 있다.