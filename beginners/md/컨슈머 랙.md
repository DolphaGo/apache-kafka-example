# 컨슈머 랙(Consumer Lag)이란?

- 카프카 랙은 카프카를 운영함에 있어서 아주 중요한 모니터링 지표 중 하나.


랙?

- 랙에 대해 이해하기 위해서는 카프카 토픽과 파티션, 컨슈머와 프로듀서, 오프셋에 대해 모두 알아야 한다.
- 카프카 프로듀서는 카프카 토픽의 파티션에 데이터를 차곡차곡 넣는다.
- 이 파티션에 데이터가 하나하나씩 들어가게 되면, offset이라는 숫자가 붙게 된다.
- 만약 파티션이 1개라고 가정하자.
- 파티션이 1개인 토픽에 0, 1, 2, 3, .. 순차적으로 데이터를 넣게 되고, consumer는 이를 가져가게 된다.

![](/images/2022-06-03-16-47-24.png)

- 컨슈머가 마지막으로 읽은 offset과 프로듀서가 마지막으로 넣은 offset의 차이가 곧 lag이다.

![](/images/2022-06-03-16-47-47.png)

- 주로 컨슈머의 상태를 볼 때 사용한다.
  

그렇기 때문에 토픽에 여러 파티션이 존재할 경우 랙은 여러개가 존재할 수 있다.

- 컨슈머 그룹이 1개이고, 파티션 2곳에서 가져간다면, 랙은 2개 측정될 수 있다.
- 이렇게 여러 개의 랙이 존재할 수 있는데 그 중 높은 숫자의 렉을 records-lag-max라고 한다.


> 정리

- 랙은 프로듀서 오프셋과 컨슈머 오프셋의 차이이다.
- 랙은 여러개가 존재할 수 있다.